<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Security-Policy"
content="
  default-src 'self';
  script-src 'self' 'unsafe-inline' https://www.googletagmanager.com https://www.google-analytics.com;
  connect-src 'self' https://www.google-analytics.com;
  frame-src 'self';
  img-src 'self' data:;
  style-src 'self' 'unsafe-inline';
  worker-src 'self' blob:;
">

<!-- Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-YXC3GLYKFL"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());
  gtag('config', 'G-YXC3GLYKFL');
</script>

<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1" />
<title>Raspberry Pi OS System & Network Hardening - Perry Kingston</title>

<link rel="stylesheet" href="footer.css">
<link rel="stylesheet" href="code-styles.css">
  
<style>
  body {
    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
    margin: 40px auto;
    max-width: 900px;
    background-color: #f7f9fc;
    color: #333;
    line-height: 1.6;
    padding: 0 20px;
    min-height: 100vh;
}
  
  h1, h2 { text-align: center; margin: 0.5em 0; }
  h1 { padding-top: 60px; }

  .pdf-wrapper {
    position: relative;
    width: 100%;
    padding-bottom: 130%;
    height: 0;
    overflow: hidden;
    border-radius: 8px;
    box-shadow: 0 2px 8px rgba(0,0,0,0.1);
    background: #fff;
  }

  .pdf-wrapper iframe { position: absolute; top:0; left:0; width:100%; height:100%; border:none; }

  @media (min-width: 768px) { .pdf-wrapper { padding-bottom: 80%; } }

 /* Floating circular back button (icon-only, bottom-right) */
  .back-button {
    position: fixed;
    bottom: 20px;
    right: 20px;
    background-color: #2980b9;
    color: white;
    width: 50px;
    height: 50px;
    border-radius: 50%;
    text-decoration: none;
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: 0 2px 6px rgba(0,0,0,0.3);
    transition: background-color 0.3s ease;
    z-index: 1000;
    cursor: pointer;
  }

  .back-button:hover {
    background-color: #555;
  }

  .back-button svg {
    width: 24px;
    height: 24px;
    fill: white;
  }

  .description {
    text-align: center;
    margin-bottom: 1.5rem;
  }
  
</style>
</head>

<body>

<!-- Floating Back Button -->
<a href="#" onclick="goBackOrDefault(event)" class="back-button" aria-label="Go Back">
  <svg viewBox="0 0 24 24">
    <path d="M15 18l-6-6 6-6" stroke="white" stroke-width="2" fill="none" stroke-linecap="round" stroke-linejoin="round"/>
  </svg>
</a>

<script>
  function goBackOrDefault(event, defaultUrl = '/CYSEC/') {
    event.preventDefault();
    if (document.referrer && document.referrer !== window.location.href) {
      window.history.back();
    } else {
      window.location.href = defaultUrl;
    }
  }
</script>

<!-- Title / Intro -->
<h1>Raspberry Pi OS System Hardening</h1>
<h2>Security Hardening & Fail2Ban Configuration Guide</h2>

<p class="description">
  This guide provides step-by-step instructions to harden a Raspberry Pi system and network settings; including SSH hardening, automated unattended updates implementation, package updates, and installation of Fail2Ban with email updates if Fail2Ban is triggered. <BR><B><U>Note:</U></B> Hardware constraints (Pi Zero 2 W) may prevent some features; for example, Fail2Ban may not install or run optimally due to CPU limitations. This document complements the <a href="https://pkrgb.github.io/CYSEC/IDS.html">Suricata IDS setup guide</a>, but was conducted on a different model, a Pi 3+ which is capable of handling Fail2Ban. There is also another walkthrough of how to implement <a href="https://pkrgb.github.io/CYSEC/UFW.html">Uncomplicated Firewall (UFW) </a> to further harden the system. 
</p>

<pre><code>
#!/bin/bash
# Fail2Ban Email Setup with msmtp and Unattended Security Updates on Debian/Raspberry Pi
# Run as root or with sudo

# --- Email validation function ---
validate_email() {
  case "$1" in
    *@*.com) return 0 ;;  # basic validation for emails ending with .com
    *) return 1 ;;
  esac
}

# --- Prompt for Gmail sender with validation ---
while true; do
  read -p "Enter your Gmail address (for sending emails): " GMAIL_USER
  if validate_email "$GMAIL_USER"; then
    break
  else
    echo "Invalid Gmail address format. Please enter a valid email ending with .com"
  fi
done

# --- Prompt for Gmail App Password ---
read -sp "Enter your Gmail App Password (see https://support.google.com/accounts/answer/185833): " GMAIL_PASS
echo

# --- Prompt for destination email with validation ---
while true; do
  read -p "Enter destination email for Fail2Ban alerts: " DEST_EMAIL
  if validate_email "$DEST_EMAIL"; then
    break
  else
    echo "Invalid destination email format. Please enter a valid email ending with .com"
  fi
done

# --- Install required packages ---
apt update
apt install -y msmtp msmtp-mta mailutils fail2ban unattended-upgrades

# --- Create /etc/msmtprc ---
cat > /etc/msmtprc <<EOF
defaults
auth           on
tls            on
tls_trust_file /etc/ssl/certs/ca-certificates.crt
logfile        /var/log/msmtp.log

account gmail
host smtp.gmail.com
port 587
from $GMAIL_USER
user $GMAIL_USER
password $GMAIL_PASS

account default : gmail
EOF

# --- Set secure permissions ---
chmod 600 /etc/msmtprc
chown root:root /etc/msmtprc

touch /var/log/msmtp.log
chmod 600 /var/log/msmtp.log
chown root:root /var/log/msmtp.log

# --- Test msmtp email sending ---
echo -e "Subject: Fail2Ban test\n\nThis is a test from $(hostname)" | msmtp -a gmail "$GMAIL_USER" || {
  echo "ERROR: msmtp test email failed. Check your Gmail credentials and network."
  exit 1
}

# --- Confirm sendmail availability ---
if ! command -v sendmail &> /dev/null; then
  echo "sendmail not found. msmtp-mta package should provide it."
  exit 1
fi

# --- Create Fail2Ban jail override for email notifications ---
mkdir -p /etc/fail2ban/jail.d
cat > /etc/fail2ban/jail.d/notify.conf <<EOF
[DEFAULT]
destemail = $DEST_EMAIL
sender = fail2ban@raspberrypi
mta = sendmail
action = %(action_mwl)s

[sshd]
enabled = true
port    = ssh
filter  = sshd
logpath = /var/log/auth.log
maxretry = 5
EOF

# --- Reload Fail2Ban service ---
systemctl reload fail2ban

# --- Safe test: ban & unban localhost IP to trigger email ---
fail2ban-client set sshd banip 127.0.0.1
fail2ban-client set sshd unbanip 127.0.0.1

# --- Enable and configure unattended security updates ---
dpkg-reconfigure --priority=low unattended-upgrades

systemctl enable unattended-upgrades
systemctl start unattended-upgrades

echo "Fail2Ban email alert setup complete. Please check your inbox for the test email."
echo "Unattended security updates installed and enabled."
</code></pre>

<footer>
  <div>
    <p>&copy; 2026 Perry Kingston | Cybersecurity Professional</p>
    <p>
      <strong>Site Security:</strong> This portfolio implements 
      <a href="https://developer.mozilla.org/en-US/docs/Web/HTTP/CSP" target="_blank" rel="noopener noreferrer">Content Security Policy (CSP)</a> headers, 
      HTTPS-only connections, and follows 
      <a href="https://owasp.org/www-project-top-ten/" target="_blank" rel="noopener noreferrer">OWASP</a> security best practices.
    </p>
    <p>
      This site uses Google Analytics for traffic analysis. No personal information is collected or stored.<br>
      By using this site, you acknowledge standard web analytics practices.
      For more information, see <a href="privacy.html" target="_blank" rel="noopener noreferrer" class="privacy-link">Privacy Policy</a>
    </p>
  </div>
</footer>
  
</body>
</html>
